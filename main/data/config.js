var websocket=new WebSocket('ws://'+location.hostname+'/ws',['arduino']);websocket.onopen=function(event){console.log('connected');websocket.send(JSON.stringify({'com':'setparams'}))};websocket.onclose=function(event){console.log('connection closed');setTimeout(init,2000);};websocket.onerror=function(error){console.log('WebSocket Error ',error);};websocket.onmessage=function(event){console.log('Server: ',event.data);obj=JSON.parse(event.data);$('#lt_span').text('Set value: '+Math.round(obj.lt/1000)+' seconds');$('#Mh_span').text('Set value: '+obj.Mh+' %');$('#mh_span').text('Set value: '+obj.mh+' %');$('#Mw_span').text('Set value: '+obj.Mw+' %');$('#mw_span').text('Set value: '+obj.mw+' %');let pumpTime=((obj.pt>=1)?Math.round(obj.pt/1000):obj.pt/1000);$('#pt_span').text('Set value: '+pumpTime+' seconds');};function init(){console.log('init');} function SetParameter(param){msg={'com':'setparams'};switch(param){case'lt':msg['lt']=document.getElementById('lt').value*1000;document.getElementById('lt').value='';break;case'Mh':msg['Mh']=document.getElementById('Mh').value;document.getElementById('Mh').value='';break;case'mh':msg['mh']=document.getElementById('mh').value;document.getElementById('mh').value='';break;case'Mw':msg['Mw']=document.getElementById('Mw').value;document.getElementById('Mw').value='';break;case'mw':msg['mw']=document.getElementById('mw').value;document.getElementById('mw').value='';break;case'pt':msg['pt']=document.getElementById('pt').value*1000;document.getElementById('pt').value='';break;default:console.log('ERROR in SetParameter()');return;} let request=JSON.stringify(msg);websocket.send(request);console.log('sent parameter');}
