var dataTransferRate=5*1000;var websocket=new WebSocket('ws://'+location.hostname+'/ws',['arduino']);websocket.onopen=function(event){console.log('connected');websocket.send(JSON.stringify({'com':'getsensorcount'}));sendRequest();timeoutId=setInterval(sendRequest,dataTransferRate);};websocket.onclose=function(event){console.log('connection closed');setTimeout(init,2000);};websocket.onerror=function(error){console.log('WebSocket Error ',error);};websocket.onmessage=function(event){console.log('Server: ',event.data);obj=JSON.parse(event.data);$('#sma').text('Average: '+obj.soilMoistureAvg+' %');populateList('sm',obj.soilMoisture);$('#temp').text('Temperature: '+obj.temp+' ÂºC');$('#hum').text('Humidity: '+obj.hum+' %');$('#wl').text('Water Level: '+obj.waterLevel+' %');populateList('ps',{0:obj.pump1,1:obj.pump2});};$(function(){$('.slider').on('change',function(){let val=$(this).val();$('#dataRateLabel').text('Rate: '+val+' seconds');dataTransferRate=val*1000;clearInterval(timeoutId);timeoutId=setInterval(sendRequest,dataTransferRate);});});function sendRequest(){websocket.send(JSON.stringify({'com':'getsensorvals'}));} function init(){console.log('init');} function populateList(id,data){let selector='#'+id;var items=[];$.each(data,function(i,item){if(typeof(item)==='boolean') items.push('<li>'+((item)?'on':'off')+'</li>');else items.push('<li>'+item+' %</li>');});$(selector).empty();$(selector).append(items.join(''));}